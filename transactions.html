{% extends "base.html" %}

{% block content %}
<div class="card">
    <h2 style="margin-bottom: 25px; color: #e5e7eb;">üí≥ All Transactions</h2>
    
    <div style="background: rgba(15, 23, 42, 0.6); padding: 20px; border-radius: 10px; margin-bottom: 25px; border: 1px solid rgba(255, 255, 255, 0.1);">
        <h3 style="margin-bottom: 15px; color: #e5e7eb;">üîç Filter Transactions</h3>
        <form method="GET" action="/transactions">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div class="form-group">
                    <label for="type">Type</label>
                    <select name="type" id="type">
                        <option value="all" {{ 'selected' if filter_type == 'all' else '' }}>All Types</option>
                        <option value="income" {{ 'selected' if filter_type == 'income' else '' }}>Income</option>
                        <option value="expense" {{ 'selected' if filter_type == 'expense' else '' }}>Expense</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="category">Category</label>
                    <select name="category" id="category">
                        <option value="all" {{ 'selected' if filter_category == 'all' else '' }}>All Categories</option>
                        {% for cat in categories %}
                        <option value="{{ cat.category }}" {{ 'selected' if filter_category == cat.category else '' }}>
                            {{ cat.category }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="start_date">From Date</label>
                    <input type="date" name="start_date" id="start_date" value="{{ start_date }}">
                </div>
                <div class="form-group">
                    <label for="end_date">To Date</label>
                    <input type="date" name="end_date" id="end_date" value="{{ end_date }}">
                </div>
            </div>
            <div style="margin-top: 15px; display: flex; gap: 10px;">
                <button type="submit" class="btn">Apply Filters</button>
                <a href="/transactions" class="btn btn-danger" style="text-decoration: none; display: inline-block;">Clear Filters</a>
            </div>
        </form>
    </div>

    {% if transactions %}
        <div style="margin-bottom: 20px; padding: 15px; background: rgba(99, 102, 241, 0.1); border-radius: 8px; border: 1px solid rgba(99, 102, 241, 0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                <div>
                    <strong style="color: #e5e7eb; font-size: 1.1em;">Total Transactions: </strong>
                    <span style="color: #a5b4fc; font-size: 1.2em;">{{ transactions|length }}</span>
                </div>
                <div>
                    {% set total_income_filtered = transactions|selectattr('type', 'equalto', 'income')|map(attribute='amount')|sum %}
                    {% set total_expense_filtered = transactions|selectattr('type', 'equalto', 'expense')|map(attribute='amount')|sum %}
                    <span style="color: #34d399; margin-right: 20px;">
                        <strong>Income:</strong> ‚Çπ{{ "%.2f"|format(total_income_filtered) }}
                    </span>
                    <span style="color: #f87171;">
                        <strong>Expenses:</strong> ‚Çπ{{ "%.2f"|format(total_expense_filtered) }}
                    </span>
                </div>
            </div>
        </div>

        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Category</th>
                        <th>Description</th>
                        <th>Amount</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for transaction in transactions %}
                    <tr>
                        <td style="white-space: nowrap;">{{ transaction.date }}</td>
                        <td>
                            <span class="badge {{ transaction.type }}">
                                {{ 'üìà' if transaction.type == 'income' else 'üìâ' }} {{ transaction.type|title }}
                            </span>
                        </td>
                        <td>
                            <strong>{{ transaction.category }}</strong>
                        </td>
                        <td style="color: #9ca3af; max-width: 300px; overflow: hidden; text-overflow: ellipsis;">
                            {{ transaction.description or '-' }}
                        </td>
                        <td style="font-weight: 600; font-size: 1.1em; white-space: nowrap; color: {{ '#34d399' if transaction.type == 'income' else '#f87171' }};">
                            {{ '+' if transaction.type == 'income' else '-' }}‚Çπ{{ "%.2f"|format(transaction.amount) }}
                        </td>
                        <td>
                            <a href="/delete_transaction/{{ transaction.id }}" 
                               class="btn btn-danger" 
                               style="padding: 8px 15px; font-size: 0.9em; text-decoration: none;"
                               onclick="return confirm('Are you sure you want to delete this transaction?')">
                                üóëÔ∏è Delete
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div style="text-align: center; padding: 60px 20px;">
            <div style="font-size: 4em; margin-bottom: 20px; opacity: 0.3;">üìä</div>
            <h3 style="color: #9ca3af; margin-bottom: 10px;">No transactions found</h3>
            <p style="color: #6b7280;">Try adjusting your filters or add your first transaction from the dashboard.</p>
            <a href="/" class="btn" style="margin-top: 20px; text-decoration: none; display: inline-block;">Go to Dashboard</a>
        </div>
    {% endif %}
</div>

{% endblock %}